---
# First play, configure the webservers.
- name: Configure webservers
  hosts: webservers
  vars_files:
    - vars/packages.yml 

  tasks:
    # Install the packages and start the related services.
    - name: Inclued the environment task file and set the variables
      include_tasks: tasks/environment.yml
      vars:
        package: "{{ item.name }}"
        service: "{{ item.service }}"
      loop: "{{ packages }}"

    # Opent the listed ports in firewalld.
    - name: Open the firewall ports
      include_tasks: tasks/firewall.yml
      vars:
        rule:
          - http
          - https

# Second play, import the test playbook and run against the webservers.
- name: Import test play file and set the variable
  import_playbook: plays/test.yml
  vars:
    host_group: webservers
